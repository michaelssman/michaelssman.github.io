# 联合

C++和C都有联合。C++的联合做了增强。

使用union 里面成员的公用存储空间，优点节省空间。

一个union里有多个成员，多个成员共用存储空间。使用union节省空间。

```c++
union U
{
private:
    int i;  //成员变量
    float f;
public:
    U(int a);   //构造函数
    U(float b);
    ~U();       //析构函数
    int read_int(); //成员函数
    float read_float();
};
```

```c++
U::U(int a) {i = a;}
U::U(float b) {f = b;}
U::~U() {cout << "U::~U()" << endl;}
int U::read_int() {return i;}
float U::read_float() {return f;}
```

```c++
void test()
{
    U X(12), Y(1.9f);
    cout << X.read_int() << endl;
    cout << Y.read_float() << endl;
}
```

Union 不安全，如果写成了`  cout << X.read_float() << endl;`无法检查出来，结果是不对的。有可能错误的使用。

- 联合（union）
  - 构造函数
  - 析构函数
  - 成员函数
  - 访问控制
- 使用类封装联合

union类型不安全。要想使用安全，使用C++的类进行封装union。

```c++
class SuperVar
{
    enum//匿名枚举
    {
        character,
        integer,
        floating_point
    } varType;//varType是SuperVar的一个枚举类型的成员变量  （varType会用在print函数里，保证类型安全的）
    union//匿名的union 使用的时候可以直接使用
    {//c i f 共用存储空间
        char c;
        int i;
        float f;
    };
public:
    SuperVar(char ch);
    SuperVar(int ii);
    SuperVar(float ff);
    void print();
};
```

源文件

```c++
//三个构造函数
SuperVar::SuperVar(char ch)
{
    c = ch;
    varType = character;
}
SuperVar::SuperVar(int ii)
{
    i = ii;
    varType = integer;
}
SuperVar::SuperVar(float ff)
{
    f = ff;
    varType = floating_point;
}
```

还有一个print函数 

print会自动检查保存响应的类型 并输出，所以不会出错，类型安全的。

```c++
void SuperVar::print()
{
    //首先检查类型,在构造函数里已经把类型保存好了
    switch (varType) {
            //根据不同的类型进行输出
        case SuperVar::character:
            cout << "character:" << c << endl;
            break;
        case SuperVar::integer:
            cout << "integer:" << i << endl;
            break;
        case SuperVar::floating_point:
            cout << "float:" << f << endl;
            break;
        default:
            break;
    }
}
```

最大优点：节省存储空间 几个成员共用存储空间。

union用的不多了，因为现在电脑内存大了。所以用union体现不出来优势。

所以用class struct多些 成员存储空间是分开的，如果是union是共用的，但是现在用class struct的多。

只有在大型的数据结构中可能用到union，因为数据多，每一个节省一点点，积少成多。可以节省一点空间。