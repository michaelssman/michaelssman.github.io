# 多态性和虚函数

- 抽象基类和纯虚函数
- 纯抽象类
- 纯虚定义
- 对象切片：传值和传地址是不同的

可以把虚函数做成纯虚函数，如果基类里有纯虚函数，那么这个基类就是抽象基类。

不能够使用抽象基类创建对象，基类做接口使用，可以把基类所有成员函数做成纯虚函数，那个这个基类就是纯抽象类。

有普通虚函数的类就不是纯抽象类。

纯抽象类和非纯抽象类都是做接口使用。

### 乐器

### 管乐器，弦乐器，打击乐器

### 木管乐器，铜管乐器

不需要用乐器创建对象，那么就可以把乐器类做成抽象类。

抽象类：虚函数是纯虚函数。

抽象类不能创建对象。抽象类可以用来做接口使用。把它的子类传进来向上类型转换，转变成抽象基类的类型。抽象类是做接口使用的。用来做接口的抽象基类可以是纯抽象类可以不是纯抽象类。

一般情况下，纯虚函数不需要定义函数体。特殊的情况可以给纯虚函数做纯虚定义。

### 纯虚定义

#### 宠物

两个纯虚函数

- eat
- speek

可以在宠物类的外部做eat，speak定义。这两个纯虚定义不是做多态用的，只是把公共的方法放在这里。可以被多个子类重复调用。

#### 使用的时候 用继承 

#### 狗继承宠物类

重写eat和speek虚函数，方法的实现中调用宠物基类的eat，speek两个公共方法的实现。

#### 猫继承宠物类

重定义虚函数，调用公共代码。

## 对象切片

多态必须是传地址，也就是传指针或引用。传值的就不是多态。

#### Animal

- 构造函数
- 虚函数

![image-20191016150257023](assets/image-20191016150257023.png)

#### Horse（马）继承Animal

- 自己的数据成员
- 构造函数 （ 初始化列表中 初始化基类）
- 虚函数重写

![image-20191016150314197](assets/image-20191016150314197.png)

##### 使用

使用的时候做一个多态

多态必须用指针或者引用，如果直接传值就不是多态，因为传值会产生对象切片，就不是多态。

不是多态：

这种不是多态，是错误的。

![image-20191016150130378](assets/image-20191016150130378.png)

这种是多态：

![image-20191016150719281](assets/image-20191016150719281.png)

测试：

![image-20191016150729643](assets/image-20191016150729643.png)

第一种不会调用Horse的describe，调用的是基类的describe方法实现，所以不是多态。

第二种会调用Horse的describe，是多态。



子类继承的基类，又添加自己特有的，所以子类比基类要大，子类向上类型转换成基类，一部分转换（可以认为是把重写的虚函数切割了）。

只有传引用或指针，使用地址在虚表中查找虚函数。



有一种方法可以避免这种情况：

基类中的虚函数做成纯虚函数，只要有一个是纯虚函数，那么就可以避免传值的这种错误情况。避免对象切片。

