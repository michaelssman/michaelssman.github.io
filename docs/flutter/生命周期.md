# 生命周期

生命周期就是回调方法，封装好的Widget处于什么状态，抽象方法让你实现。

作用：

- 初始化数据
  - 创建变量、常量
  - 发送网络数据
- 监听小部件的事件
- 管理内存
  - 销毁数据、销毁监听者
  - 销毁timer等等

## StatelessWidget

1. 构造方法
2. bulid方法

## StatefulWidget

1. StatefulWidget构造函数

2. createState方法

3. State的构造方法

4. State的init方法：`void initState()`

5. didChangeDependencies方法

   改变依赖关系

   build方法之前

   依赖（共享数据）的InheritedWidget发生变化之后，didChangeDependencies才会调用。

6. State的bulid方法

   当调用setState方法，会重新调用Build进行渲染

   setState方法内部主要是利用_element（本质就是context对象）调用markNeedsBuild

7. deactivate

   State从渲染树中移除的时候调用

8. dispose方法：`void dispose()`

   页面切换销毁

## setState方法

```dart
@protected
void setState(VoidCallback fn) {
  /**
  一系列判断
  */
  _element!.markNeedsBuild();//标记需要被渲染
}
```

##### _element

**context就是_element**

```dart
BuildContext get context {
  assert(() {
    if (_element == null) {
      throw FlutterError(
        'This widget has been unmounted, so the State no longer has a context (and should be considered defunct). \n'
        'Consider canceling any active work during "dispose" or using the "mounted" getter to determine if the State is still active.',
      );
    }
    return true;
  }());
  return _element!;
}
StatefulElement? _element;
```

```dart
setState(() {});
//等于下面
context as StatefulElement;
context.markNeedsBuild();
```