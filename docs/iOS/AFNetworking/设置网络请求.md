# 设置网络请求

## 设置User-Agent

1. 在afn里面设置
   在`AFURLRequestSerialization`文件中的`init`方法中去修改`User-Agent`
   在设置`[self setValue:userAgent forHTTPHeaderField:@"User-Agent"];`之前添加信息：

```
  userAgent = [userAgent stringByAppendingString:[NSString stringWithFormat:@" lemonapp/%@/DeviceID:%@/", <#app版本号#>, <#设备UUID#>]];
```

2. 在外面设置

```
  // 修改userAgent
  NSString *userAgent = [manager.requestSerializer valueForHTTPHeaderField:@"User-Agent"];
  userAgent = [userAgent stringByAppendingString:[NSString stringWithFormat:@" AccSchool/%@/DeviceID:%@/", [ACSystemManager getVersionNumber], [ACSystemManager getDeviceId]]];
  [manager.requestSerializer setValue:userAgent forHTTPHeaderField:@"User-Agent"];

```



## 设置请求头

1. 请求接口需要传用户信息进行验证，将用户token放在网络请求的头部。

```
[manager.requestSerializer setValue:<#access_token#> forHTTPHeaderField:@"Authorization"];
```

2. 设置特殊的Content-Type类型

`application/x-www-form-urlencoded`表单的形式key=value&

请求头传过去，告诉服务器。

```objective-c
    [manager.requestSerializer setValue: @"application/x-www-form-urlencoded" forHTTPHeaderField:@"Content-Type"];
```

3. 设置其他的

   1. 设置requset

      ```objective-c
        [manager.requestSerializer setValue:@"text/html; charset=utf-8" forHTTPHeaderField:@"Content-Type"];
        [manager.requestSerializer setValue:@"application/json" forHTTPHeaderField:@"Accept"];
        [manager.requestSerializer setValue:@"zh_CN" forHTTPHeaderField:@"Accept-Language"];
        [manager.requestSerializer setValue:@"application/json;charset=UTF-8" forHTTPHeaderField:@"Content-Type"];
        [manager.requestSerializer setValue:@"domain=.ximalaya.com; path=/; channel=ios-b1; 1&_device=iPhone&6703CF0C-6676-41C1-A5EB-CEA4A1EFEEC8&3.1.43; impl=com.jima.yijingtingshu; 1&_token=7104330&d858cae50f5f704f4f09c0607e30a375bbfc" forHTTPHeaderField:@"Cookie"]; 
      ```

   2. 设置response

      ```objective-c
        1、设置
        manager.responseSerializer.acceptableContentTypes = [NSSet setWithObjects:@"text/xml", nil];
        2、集合中添加
        manager.responseSerializer.acceptableContentTypes = [manager.responseSerializer.acceptableContentTypes setByAddingObject:@"text/html"];  
      ```



# 关于POST
在方法中看到请求的方法 ` self.HTTPMethodsEncodingParametersInURI = [NSSet setWithObjects:@"GET", @"HEAD", @"DELETE", nil]; ` 里面没有POST请求。
POST请求的需要设置：

```
[[AFHTTPRequestSerializer serializer] setValue:newUserAgent forHTTPHeaderField:@"User-Agent"];
```

### post 参数为数组


#### 参数仅仅只有数组：
参数只有数组 没有参数名
需要设置一下
    NSSet *set = [NSSet setWithArray:array];
然后将set作为参数即可。

#### 请求序列化器：

post请求，加载更多，数据会重复第一次的数据，所以需要设置请求序列化器：

```
manager.requestSerializer = [AFJSONRequestSerializer serializer];
```

上面那行最先设置。

然后设置请求头

```
[manager.requestSerializer setValue:<#access_token#> forHTTPHeaderField:@"Authorization"];
```



