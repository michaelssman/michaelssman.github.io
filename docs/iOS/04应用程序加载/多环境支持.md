# 多环境支持

搭建多环境支持，优化开发流程

基于同一套源代码自动构建出有差异功能的app。

支持多个团队并行开发。

分离测试和生产环境。

## Xcode 构建基础概念

一般在构建一个 iOS App 的时候，需要用到 Xcode Project，Xcode Target，Build Settings，Build Configuration 和 Xcode Scheme 等构建配置。

## xcconfig

创建Config目录，创建xcconfig文件

主工程创建Configuration Setting File文件，xcconfing是控制build setting的。可以把输出结果

编译需要配置：

> PROJECT->Info->Configurations->Debug和Release->每一个target对应一个xcconfig文件

只能配置一个config文件，如果有其它的config文件需要include。

配置了xcconfig，要在对应的build setting中对应设置的值给删除，改为设置`$(inherited)`

### 多个target

动态库或iWarch的应用的BundleID必须要跟主应用程序的bundleid一致，比如你的应用的id是com.mycop.hello，那么内嵌的id必须是com.mycop.hello.xxx

## Xcode Project

**Xcode Project**用于组织源代码文件和资源文件。一个 Project 可以包含多个 Target，例如当我们新建一个 Xcode Project 的时候，它会自动生成 App 的主 Target，Unit Test Target 和 UI Test Target。

## 使用Build Configuration 和 Xcode Scheme来管理多环境

在构建过程中怎样才能选择不同的 Build Configuration 呢？答案是使用 Xcode Scheme。

### Xcode Scheme

**Xcode Scheme**用于定义一个完整的构建过程，其包括指定哪些 Target 需要进行构建，构建过程中使用了哪个 Build Configuration ，以及需要执行哪些测试案例等等。在项目新建的时候只有一个 Scheme，但可以为同一个项目建立多个 Scheme。不过这么多 Scheme 中，同一时刻只能有一个 Scheme 生效。

## fastlane自动化打包

安装 Xcode command line tools：`xcode-select --install`

安装fastlane：`sudo gem install fastlane`

cd工程所在目录，执行`fastlane init`

选择2打包testfilght。

输入开发者账号和密码。

执行：`fastlane [laane_name]`