# 多线程

## 基本概念

### 进程

在系统中正在运行的一个应用程序，每个进程之间是独立的，每个进程均运行在其专用且受保护的内存空间。

### 线程

一个进程（程序）的所有任务都在线程中执行，每个进程至少有一个线程（主线程）

### 多线程

一个进程可以开启多条线程，多条线程可以并行（同时）执行不同的任务，多线程并发（同时）执行，其实是CPU快速的在多条线程之间调度（切换）。

### 主线程

- 一个iOS程序运行后，默认会开启一条线程，称为主线程
  - 处理UI时间（点击事件、滚动事件、拖拽事件等）
  - 显示、刷新UI界面

## 实现方案

pthread（C）

- 适用于Unix\Linux\Windows等系统
- 跨平台\可移植
- 一套通用的多线程API
- 线程生命周期需程序员管理

NSThread（OC）

- 使用更加面向对象
- 可直接操作线程对象
- 线程生命周期需程序员管理

GCD（C）

- 充分利用设备的多核
- 线程生命周期自动管理

NSOperation（OC）

- 基于GCD（底层是GCD）
- 使用更加面向对象
- 线程生命周期自动管理

## 多线程优缺点

优点

- 能适当提高程序的执行效率
- 能适当提高资源使用率（CPU、内存利用率）

缺点

- 创建线程是有开销的，iOS下主要成本包括：内核数据结构（大约1KB）、栈空间、创建时间90ms。
- 如果开启大量线程，会降低程序性能
- 线程越多，CPU在调度线程上的开销越大
- 程序设计更加复杂：比如线程之间的通信、多线程的数据共享

# NSThread

# NSOperation

# GCD

<img src="多线程.assets/multithread.png" alt="multithread"  />